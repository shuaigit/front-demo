(self["webpackChunkwebapp"]=self["webpackChunkwebapp"]||[]).push([[559],{6983:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return z}});var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"total_container"},[t("el-container",{staticClass:"preview_outside_container"},[t("el-container",{class:"ai"==e.mode_option?"preview_main_container_ai":"preview_main_container_normal"},[t("el-main",{staticClass:"preview_capture_left_container"},[t("el-container",{staticClass:"preview_container",attrs:{id:"video_container_0"}},[t("el-main",{ref:"axMain0",staticClass:"video_container"},[t("video",{directives:[{name:"show",rawName:"v-show",value:e.streamOptions[e.snsOptLeft.snsInfo[e.snsOptLeft.snsOptInd].id].showVideoStatus,expression:"streamOptions[snsOptLeft.snsInfo[snsOptLeft.snsOptInd].id].showVideoStatus"}],ref:"axVideoRef0",staticClass:"axVideo",attrs:{id:"myVideo0",muted:"isMuted",autoplay:"",playsinline:"",oncontextmenu:"return false;"},domProps:{muted:!0}}),t("canvas",{directives:[{name:"show",rawName:"v-show",value:!e.streamOptions[e.snsOptLeft.snsInfo[e.snsOptLeft.snsOptInd].id].showVideoStatus,expression:"!streamOptions[snsOptLeft.snsInfo[snsOptLeft.snsOptInd].id].showVideoStatus"}],staticClass:"axVideo2",attrs:{id:"myMjpeg0"}})]),t("el-footer",{staticClass:"video_controls_container",attrs:{height:"30px"}},[t("div",{staticClass:"left_controls_container"},[t("div",{staticClass:"size_option"},[t("el-dropdown",{attrs:{size:"mini",placement:"top-start",trigger:"click"},on:{command:e.changeSizeOption0}},[t("el-button",{staticClass:"el-dropdown-link",attrs:{size:"mini",type:"text"}},[e._v(e._s(e.sizeOptions[e.streamOptions[e.snsOptLeft.snsInfo[e.snsOptLeft.snsOptInd].id].sizeOptionInd].label))]),t("el-dropdown-menu",{attrs:{slot:"dropdown","append-to-body":!1},slot:"dropdown"},e._l(e.sizeOptions,(function(s){return t("el-dropdown-item",{key:s.id,attrs:{command:s.id+"",icon:s.icon}},[e._v(e._s(s.label))])})),1)],1)],1),t("div",[t("el-dropdown",{attrs:{size:"mini",placement:"top",trigger:"click"},on:{command:e.changeStream0}},[t("el-button",{staticClass:"el-dropdown-link",attrs:{size:"mini",type:"text"}},[e._v(e._s(e.streamOptions[e.snsOptLeft.snsInfo[e.snsOptLeft.snsOptInd].id].videoInfo[e.streamOptions[e.snsOptLeft.snsInfo[e.snsOptLeft.snsOptInd].id].streamInd].label))]),t("el-dropdown-menu",{attrs:{slot:"dropdown","-to-body":!1},slot:"dropdown"},e._l(e.streamOptions[e.snsOptLeft.snsInfo[e.snsOptLeft.snsOptInd].id].videoInfo,(function(s){return t("el-dropdown-item",{key:s.id,attrs:{command:s.id+"",icon:s.icon}},[e._v(e._s(s.label))])})),1)],1)],1),t("div",{directives:[{name:"show",rawName:"v-show",value:e.sns_num>=3,expression:"sns_num >= 3"}],staticClass:"src_option"},[t("el-dropdown",{attrs:{size:"mini",placement:"top",trigger:"click"},on:{command:e.changeSnsOptLeft}},[t("el-button",{staticClass:"el-dropdown-link",attrs:{size:"mini",type:"text"}},[e._v(e._s(e.snsOptLeft.snsInfo[e.snsOptLeft.snsOptInd].label))]),t("el-dropdown-menu",{attrs:{slot:"dropdown","-to-body":!1},slot:"dropdown"},e._l(e.snsOptLeft.snsInfo,(function(s){return t("el-dropdown-item",{key:s.id,attrs:{command:s.id+"",icon:s.icon}},[e._v(e._s(s.label))])})),1)],1)],1),t("div",{staticClass:"size_info"},[t("span",[e._v(e._s(this.streamOptions[e.snsOptLeft.snsInfo[e.snsOptLeft.snsOptInd].id].encInfo))])])]),t("div",{staticClass:"right_controls_container"},[t("div",{staticClass:"draw_option"},[t("el-tooltip",{attrs:{effect:"dark",content:"缩小",placement:"top-end",enterable:!1}},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.ezoomEnable,expression:"ezoomEnable"}],staticClass:"draw_button_enable",attrs:{size:"mini",icon:"el-icon-remove"},on:{click:function(t){return e.ZoomOut(e.snsOptLeft.snsInfo[e.snsOptLeft.snsOptInd].id,.1)}}})],1)],1),t("div",{staticClass:"draw_option"},[t("el-tooltip",{attrs:{effect:"dark",content:"放大",placement:"top-end",enterable:!1}},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.ezoomEnable,expression:"ezoomEnable"}],staticClass:"draw_button_enable",attrs:{size:"mini",icon:"el-icon-circle-plus"},on:{click:function(t){return e.ZoomIn(e.snsOptLeft.snsInfo[e.snsOptLeft.snsOptInd].id,.1)}}})],1)],1),t("div",{staticClass:"ezoom"},[t("el-slider",{directives:[{name:"show",rawName:"v-show",value:e.ezoomEnable,expression:"ezoomEnable"}],staticClass:"ezoom_slider",attrs:{min:1,max:e.ezoom[e.snsOptLeft.snsInfo[e.snsOptLeft.snsOptInd].id].max_ratio,step:e.ezoom[e.snsOptLeft.snsInfo[e.snsOptLeft.snsOptInd].id].step},on:{input:function(t){return e.onEZoom(e.snsOptLeft.snsInfo[e.snsOptLeft.snsOptInd].id)}},nativeOn:{mousedown:function(t){return e.onEZoomMousedown(e.snsOptLeft.snsInfo[e.snsOptLeft.snsOptInd].id)}},model:{value:e.ezoom[e.snsOptLeft.snsInfo[e.snsOptLeft.snsOptInd].id].ezoom_ratio,callback:function(t){e.$set(e.ezoom[e.snsOptLeft.snsInfo[e.snsOptLeft.snsOptInd].id],"ezoom_ratio",t)},expression:"ezoom[snsOptLeft.snsInfo[snsOptLeft.snsOptInd].id].ezoom_ratio"}})],1),t("div",{staticClass:"draw_option"},[t("el-tooltip",{attrs:{effect:"dark",content:e.isTalking?"停止对讲":"开始对讲",placement:"top-end",enterable:!1}},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.aenc_enable&&"MJPEG"!=e.sns0CurDisplayMediaType&&0===e.snsOptLeft.snsInfo[e.snsOptLeft.snsOptInd].id,expression:"aenc_enable && sns0CurDisplayMediaType != 'MJPEG' && snsOptLeft.snsInfo[snsOptLeft.snsOptInd].id === 0"}],staticClass:"draw_button_enable",attrs:{size:"mini",icon:e.isTalking?"iconfont icon-mic-off":"iconfont icon-mic-on"},on:{click:function(t){return e.onStartTalk()}}})],1)],1),t("div",{staticClass:"draw_option"},[t("el-tooltip",{attrs:{effect:"dark",content:e.isMuted?"播音":"静音",placement:"top-end",enterable:!1}},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.aenc_enable&&"MJPEG"!=e.sns0CurDisplayMediaType&&0===e.snsOptLeft.snsInfo[e.snsOptLeft.snsOptInd].id,expression:"aenc_enable && sns0CurDisplayMediaType != 'MJPEG' && snsOptLeft.snsInfo[snsOptLeft.snsOptInd].id === 0"}],staticClass:"draw_button_enable",attrs:{size:"mini",icon:e.isMuted?"iconfont icon-silence":"iconfont icon-sound"},on:{click:function(t){return e.onMute()}}})],1)],1),t("div",{staticClass:"draw_option"},[t("el-tooltip",{attrs:{effect:"dark",content:"抓拍",placement:"top-end"}},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:0===e.snsOptLeft.snsInfo[e.snsOptLeft.snsOptInd].id,expression:"snsOptLeft.snsInfo[snsOptLeft.snsOptInd].id === 0"}],class:{draw_button_enable:!0,draw_button_disable:!1},attrs:{size:"mini",icon:"el-icon-camera-solid"},on:{click:function(t){return e.onSnapshot(e.snsOptLeft.snsInfo[e.snsOptLeft.snsOptInd].id)}}})],1)],1),t("div",{staticClass:"draw_option"},[t("el-tooltip",{attrs:{effect:"dark",content:"录入人像信息",placement:"top-end",enterable:!1}},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.isSearchImg&&"facehuman"==e.detect_mode,expression:"isSearchImg && detect_mode == 'facehuman'"}],class:{draw_button_enable:!0,draw_button_disable:!1},attrs:{size:"mini",icon:"el-icon-user-solid"},on:{click:function(t){return e.recordFaceinfo(e.snsOptLeft.snsInfo[e.snsOptLeft.snsOptInd].id)}}})],1)],1),t("div",{staticClass:"draw_option"},[t("el-tooltip",{attrs:{effect:"dark",content:e.streamOptions[e.snsOptLeft.snsInfo[e.snsOptLeft.snsOptInd].id].isRecStart?"停止录像":"开启录像",placement:"top-end",enterable:!1}},[t("el-button",{staticClass:"draw_button_enable",attrs:{size:"mini",disabled:!e.streamOptions[e.snsOptLeft.snsInfo[e.snsOptLeft.snsOptInd].id].recEnable,icon:e.streamOptions[e.snsOptLeft.snsInfo[e.snsOptLeft.snsOptInd].id].recIcon},on:{click:function(t){return e.onRecording(e.snsOptLeft.snsInfo[e.snsOptLeft.snsOptInd].id)}}})],1)],1),t("div",{staticClass:"full_option"},[t("el-tooltip",{attrs:{effect:"dark",content:e.isFullScreen?"退出全屏":"进入全屏",placement:"top-end",enterable:!1}},[t("el-button",{staticClass:"full_button",attrs:{size:"mini",icon:e.screenIcon},on:{click:function(t){return e.doScreen(e.snsOptLeft.snsInfo[e.snsOptLeft.snsOptInd].id)}}})],1)],1)])])],1)],1),t("div",{directives:[{name:"show",rawName:"v-show",value:2===e.preview_sns_mode,expression:"preview_sns_mode === 2"}],staticClass:"preview_seperator_line"}),t("el-main",{directives:[{name:"show",rawName:"v-show",value:2===e.preview_sns_mode,expression:"preview_sns_mode === 2"}],staticClass:"preview_capture_left_container"},[t("el-container",{staticClass:"preview_container",attrs:{id:"video_container_1"}},[t("el-main",{ref:"axMain1",staticClass:"video_container"},[t("video",{directives:[{name:"show",rawName:"v-show",value:e.streamOptions[1].showVideoStatus,expression:"streamOptions[1].showVideoStatus"}],ref:"axVideoRef1",staticClass:"axVideo",attrs:{id:"myVideo1",autoplay:"",muted:"true",playsinline:"",oncontextmenu:"return false;"},domProps:{muted:!0}}),t("canvas",{directives:[{name:"show",rawName:"v-show",value:!e.streamOptions[1].showVideoStatus,expression:"!streamOptions[1].showVideoStatus"}],staticClass:"axVideo2",attrs:{id:"myMjpeg1"}})]),t("el-footer",{staticClass:"video_controls_container",attrs:{height:"30px"}},[t("div",{staticClass:"left_controls_container"},[t("div",{staticClass:"size_option"},[t("el-dropdown",{attrs:{size:"mini",placement:"top-start",trigger:"click"},on:{command:e.changeSizeOption1}},[t("el-button",{staticClass:"el-dropdown-link",attrs:{size:"mini",type:"text",disabled:1==e.sns_num}},[e._v(e._s(e.sizeOptions[e.streamOptions[1].sizeOptionInd].label))]),t("el-dropdown-menu",{attrs:{slot:"dropdown","append-to-body":!1},slot:"dropdown"},e._l(e.sizeOptions,(function(s){return t("el-dropdown-item",{key:s.id,attrs:{command:s.id+"",icon:s.icon}},[e._v(e._s(s.label))])})),1)],1)],1),t("div",[t("el-dropdown",{attrs:{size:"mini",placement:"top",trigger:"click"},on:{command:e.changeStream1}},[t("el-button",{staticClass:"el-dropdown-link",attrs:{size:"mini",type:"text",disabled:1==e.sns_num}},[e._v(e._s(e.streamOptions[1].videoInfo[e.streamOptions[1].streamInd].label))]),t("el-dropdown-menu",{attrs:{slot:"dropdown","append-to-body":!1},slot:"dropdown"},e._l(e.streamOptions[1].videoInfo,(function(s){return t("el-dropdown-item",{key:s.id,attrs:{command:s.id+"",icon:s.icon}},[e._v(e._s(s.label))])})),1)],1)],1),t("div",{staticClass:"size_info"},[t("span",{attrs:{calss:"dynamic_font"}},[e._v(e._s(this.streamOptions[1].encInfo))])])]),t("div",{staticClass:"right_controls_container"},[t("div",{staticClass:"draw_option"},[t("el-tooltip",{attrs:{effect:"dark",content:"缩小",placement:"top-end",enterable:!1}},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.ezoomEnable,expression:"ezoomEnable"}],staticClass:"draw_button_enable",attrs:{size:"mini",icon:"el-icon-remove"},on:{click:function(t){return e.ZoomOut(1,.1)}}})],1)],1),t("div",{staticClass:"draw_option"},[t("el-tooltip",{attrs:{effect:"dark",content:"放大",placement:"top-end",enterable:!1}},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.ezoomEnable,expression:"ezoomEnable"}],staticClass:"draw_button_enable",attrs:{size:"mini",icon:"el-icon-circle-plus"},on:{click:function(t){return e.ZoomIn(1,.1)}}})],1)],1),t("div",{staticClass:"ezoom"},[t("el-slider",{directives:[{name:"show",rawName:"v-show",value:e.ezoomEnable,expression:"ezoomEnable"}],staticClass:"ezoom_slider",attrs:{min:1,max:e.ezoom[1].max_ratio,step:e.ezoom[1].step},on:{input:function(t){return e.onEZoom(1)}},nativeOn:{mousedown:function(t){return e.onEZoomMousedown(1)}},model:{value:e.ezoom[1].ezoom_ratio,callback:function(t){e.$set(e.ezoom[1],"ezoom_ratio",t)},expression:"ezoom[1].ezoom_ratio"}})],1),t("div",{staticClass:"draw_option"},[t("el-tooltip",{attrs:{effect:"dark",content:"抓拍",placement:"top-end"}},[t("el-button",{class:{draw_button_enable:!0,draw_button_disable:!1},attrs:{size:"mini",icon:"el-icon-camera-solid"},on:{click:function(t){return e.onSnapshot(1)}}})],1)],1),t("div",{staticClass:"draw_option"},[t("el-tooltip",{attrs:{effect:"dark",content:"录入人像信息",placement:"top-end",enterable:!1}},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.isSearchImg&&"facehuman"==e.detect_mode,expression:"isSearchImg && detect_mode == 'facehuman'"}],class:{draw_button_enable:!0,draw_button_disable:!1},attrs:{size:"mini",icon:"el-icon-user-solid"},on:{click:function(t){return e.recordFaceinfo(1)}}})],1)],1),t("div",{staticClass:"draw_option"},[t("el-tooltip",{attrs:{effect:"dark",content:e.streamOptions[1].isRecStart?"停止录像":"开启录像",placement:"top-end",enterable:!1}},[t("el-button",{staticClass:"draw_button_enable",attrs:{size:"mini",disabled:!e.streamOptions[1].recEnable,icon:e.streamOptions[1].recIcon},on:{click:function(t){return e.onRecording(1)}}})],1)],1),t("div",{staticClass:"full_option"},[t("el-tooltip",{attrs:{effect:"dark",content:e.isFullScreen?"退出全屏":"进入全屏",placement:"top-end",enterable:!1}},[t("el-button",{staticClass:"full_button",attrs:{size:"mini",icon:e.screenIcon,disabled:1==e.sns_num},on:{click:function(t){return e.doScreen(1)}}})],1)],1)])])],1)],1),t("el-aside",{directives:[{name:"show",rawName:"v-show",value:"ai"==e.mode_option,expression:"mode_option == 'ai'"}],staticClass:"side_identify_events_container",attrs:{width:"335px"}},[t("el-container",{staticClass:"identify_events_container"},[t("el-header",{staticClass:"identify_container"},[t("el-row",{staticClass:"image_info_container"},[t("el-col",{staticClass:"image_col",attrs:{span:10}},[t("div",{staticClass:"image-large"},[""==e.currentImg.src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.currentImg.src?t("img",{staticClass:"image-large",attrs:{src:e.currentImg.src,crossOrigin:"anonymous"},on:{click:function(t){return e.look(e.currentImg)}}}):e._e()])]),t("el-col",{staticClass:"info_col",attrs:{span:14}},[t("div",{staticClass:"info_container"},[t("div",{directives:[{name:"show",rawName:"v-show",value:"facehuman"==e.detect_mode,expression:"detect_mode == 'facehuman'"}],staticClass:"info_text"},[e._v(" 性别： "+e._s(e.currentImg.info.gender)+" ")]),t("div",{directives:[{name:"show",rawName:"v-show",value:"facehuman"==e.detect_mode,expression:"detect_mode == 'facehuman'"}],staticClass:"info_text"},[e._v(" 年龄： "+e._s(e.currentImg.info.age)+" ")]),t("div",{directives:[{name:"show",rawName:"v-show",value:"facehuman"==e.detect_mode,expression:"detect_mode == 'facehuman'"}],staticClass:"info_text"},[e._v(" 口罩： "+e._s(e.currentImg.info.mask)+" ")]),t("div",{directives:[{name:"show",rawName:"v-show",value:"hvcfp"==e.detect_mode,expression:"detect_mode == 'hvcfp'"}],staticClass:"info_text"},[e._v(" 车牌号码："+e._s(e.currentImg.info.number)+" ")]),t("div",{directives:[{name:"show",rawName:"v-show",value:"hvcfp"==e.detect_mode,expression:"detect_mode == 'hvcfp'"}],staticClass:"info_text"},[e._v(" 车牌颜色："+e._s(e.currentImg.info.color)+" ")])])])],1)],1),t("el-main",{staticClass:"events_container"},[t("el-table",{staticClass:"events_table",staticStyle:{"font-size":"10px"},attrs:{"header-cell-style":{background:"#2C2C2C",color:"#B0B0B0",border:"none",fontSize:"10px",padding:"4px"},"cell-style":{padding:"4px"},"row-style":{height:"16px"},height:"150",data:e.eventList,"highlight-current-row":""}},[t("el-table-column",{attrs:{type:"index",label:"#",width:"50"}}),t("el-table-column",{attrs:{property:"date",label:"发生时间",width:"105"}}),t("el-table-column",{attrs:{property:"sensor",label:"Camera",width:"85"}}),t("el-table-column",{attrs:{property:"type",label:"事件类型",width:"85"}})],1)],1)],1)],1)],1),t("el-footer",{directives:[{name:"show",rawName:"v-show",value:"hvcfp"==e.detect_mode&&"ai"==e.mode_option,expression:"detect_mode == 'hvcfp' && mode_option == 'ai'"}],staticClass:"hvcfp_img_container"},[t("el-row",{staticClass:"img_list_top"},[t("el-col",{staticClass:"hvcfp_img_col",attrs:{span:2}},[t("div",{staticClass:"type_text"},[e._v("人脸")])]),t("el-col",{staticClass:"hvcfp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"hvcfp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-small"},[""==e.pushHCVFPImages.face[s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushHCVFPImages.face[s-1].src?t("img",{staticClass:"image-small",attrs:{src:e.pushHCVFPImages.face[s-1].src},on:{click:function(t){return e.look(e.pushHCVFPImages.face[s-1])}}}):e._e()])])})),1),t("el-col",{staticClass:"hvcfp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"hvcfp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-small"},[""==e.pushHCVFPImages.face[e.image_count/2+s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushHCVFPImages.face[e.image_count/2+s-1].src?t("img",{staticClass:"image-small",attrs:{src:e.pushHCVFPImages.face[e.image_count/2+s-1].src},on:{click:function(t){return e.look(e.pushHCVFPImages.face[e.image_count/2+s-1])}}}):e._e()])])})),1)],1),t("el-row",{staticClass:"img_list"},[t("el-col",{staticClass:"hvcfp_img_col",attrs:{span:2}},[t("div",{staticClass:"type_text"},[e._v("人形")])]),t("el-col",{staticClass:"hvcfp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"hvcfp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-small"},[""==e.pushHCVFPImages.body[s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushHCVFPImages.body[s-1].src?t("img",{staticClass:"image-small",attrs:{src:e.pushHCVFPImages.body[s-1].src},on:{click:function(t){return e.look(e.pushHCVFPImages.body[s-1])}}}):e._e()])])})),1),t("el-col",{staticClass:"hvcfp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"hvcfp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-small"},[""==e.pushHCVFPImages.body[e.image_count/2+s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushHCVFPImages.body[e.image_count/2+s-1].src?t("img",{staticClass:"image-small",attrs:{src:e.pushHCVFPImages.body[e.image_count/2+s-1].src},on:{click:function(t){return e.look(e.pushHCVFPImages.body[e.image_count/2+s-1])}}}):e._e()])])})),1)],1),t("el-row",{staticClass:"img_list"},[t("el-col",{staticClass:"hvcfp_img_col",attrs:{span:2}},[t("div",{staticClass:"type_text"},[e._v("非机动车")])]),t("el-col",{staticClass:"hvcfp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"hvcfp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-small"},[""==e.pushHCVFPImages.cycle[s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushHCVFPImages.cycle[s-1].src?t("img",{staticClass:"image-small",attrs:{src:e.pushHCVFPImages.cycle[s-1].src},on:{click:function(t){return e.look(e.pushHCVFPImages.cycle[s-1])}}}):e._e()])])})),1),t("el-col",{staticClass:"hvcfp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"hvcfp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-small"},[""==e.pushHCVFPImages.cycle[e.image_count/2+s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushHCVFPImages.cycle[e.image_count/2+s-1].src?t("img",{staticClass:"image-small",attrs:{src:e.pushHCVFPImages.cycle[e.image_count/2+s-1].src},on:{click:function(t){return e.look(e.pushHCVFPImages.cycle[e.image_count/2+s-1])}}}):e._e()])])})),1)],1),t("el-row",{staticClass:"img_list"},[t("el-col",{staticClass:"hvcfp_img_col",attrs:{span:2}},[t("div",{staticClass:"type_text"},[e._v("机动车")])]),t("el-col",{staticClass:"hvcfp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"hvcfp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-small"},[""==e.pushHCVFPImages.vechicle[s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushHCVFPImages.vechicle[s-1].src?t("img",{staticClass:"image-small",attrs:{src:e.pushHCVFPImages.vechicle[s-1].src},on:{click:function(t){return e.look(e.pushHCVFPImages.vechicle[s-1])}}}):e._e()])])})),1),t("el-col",{staticClass:"hvcfp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"hvcfp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-small"},[""==e.pushHCVFPImages.vechicle[e.image_count/2+s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushHCVFPImages.vechicle[e.image_count/2+s-1].src?t("img",{staticClass:"image-small",attrs:{src:e.pushHCVFPImages.vechicle[e.image_count/2+s-1].src},on:{click:function(t){return e.look(e.pushHCVFPImages.vechicle[e.image_count/2+s-1])}}}):e._e()])])})),1)],1),t("el-row",{staticClass:"img_list_bottom"},[t("el-col",{staticClass:"hvcfp_img_col",attrs:{span:2}},[t("div",{staticClass:"type_text"},[e._v("车牌")])]),t("el-col",{staticClass:"hvcfp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"hvcfp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-small"},[""==e.pushHCVFPImages.plate[s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushHCVFPImages.plate[s-1].src?t("img",{staticClass:"image-small",attrs:{src:e.pushHCVFPImages.plate[s-1].src},on:{click:function(t){return e.look(e.pushHCVFPImages.plate[s-1])}}}):e._e()])])})),1),t("el-col",{staticClass:"hvcfp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"hvcfp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-small"},[""==e.pushHCVFPImages.plate[e.image_count/2+s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushHCVFPImages.plate[e.image_count/2+s-1].src?t("img",{staticClass:"image-small",attrs:{src:e.pushHCVFPImages.plate[e.image_count/2+s-1].src},on:{click:function(t){return e.look(e.pushHCVFPImages.plate[e.image_count/2+s-1])}}}):e._e()])])})),1)],1)],1),t("el-footer",{directives:[{name:"show",rawName:"v-show",value:"facehuman"==e.detect_mode&&"ai"==e.mode_option,expression:"detect_mode == 'facehuman' && mode_option == 'ai'"}],staticClass:"fh_img_container"},[t("el-row",{staticClass:"img_list_top"},[t("el-col",{staticClass:"fp_img_col",attrs:{span:2}},[t("div",{staticClass:"type_text_fh"},[e._v("人脸")])]),t("el-col",{staticClass:"fp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"fp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-medium"},[""==e.pushFHImages.face[s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushFHImages.face[s-1].src?t("img",{staticClass:"image-medium",attrs:{src:e.pushFHImages.face[s-1].src},on:{click:function(t){return e.look(e.pushFHImages.face[s-1])}}}):e._e()])])})),1),t("el-col",{staticClass:"fp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"fp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-medium"},[""==e.pushFHImages.face[e.image_count/2+s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushFHImages.face[e.image_count/2+s-1].src?t("img",{staticClass:"image-medium",attrs:{src:e.pushFHImages.face[e.image_count/2+s-1].src},on:{click:function(t){return e.look(e.pushFHImages.face[e.image_count/2+s-1])}}}):e._e()])])})),1)],1),t("el-row",{staticClass:"img_list"},[t("el-col",{staticClass:"fp_img_col",attrs:{span:2}},[t("div",{staticClass:"type_text_fh"},[e._v("人脸")])]),t("el-col",{staticClass:"fp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"fp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-medium"},[""==e.pushFHImages.face[e.image_count+s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushFHImages.face[e.image_count+s-1].src?t("img",{staticClass:"image-medium",attrs:{src:e.pushFHImages.face[e.image_count+s-1].src},on:{click:function(t){return e.look(e.pushFHImages.face[e.image_count+s-1])}}}):e._e()])])})),1),t("el-col",{staticClass:"fp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"fp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-medium"},[""==e.pushFHImages.face[e.image_count/2+e.image_count+s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushFHImages.face[e.image_count/2+e.image_count+s-1].src?t("img",{staticClass:"image-medium",attrs:{src:e.pushFHImages.face[e.image_count/2+e.image_count+s-1].src},on:{click:function(t){return e.look(e.pushFHImages.face[e.image_count/2+e.image_count+s-1])}}}):e._e()])])})),1)],1),t("el-row",{staticClass:"img_list"},[t("el-col",{staticClass:"fp_img_col",attrs:{span:2}},[t("div",{staticClass:"type_text_fh"},[e._v("人形")])]),t("el-col",{staticClass:"fp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"fp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-medium"},[""==e.pushFHImages.body[s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushFHImages.body[s-1].src?t("img",{staticClass:"image-medium",attrs:{src:e.pushFHImages.body[s-1].src},on:{click:function(t){return e.look(e.pushFHImages.body[s-1])}}}):e._e()])])})),1),t("el-col",{staticClass:"fp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"fp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-medium"},[""==e.pushFHImages.body[e.image_count/2+s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushFHImages.body[e.image_count/2+s-1].src?t("img",{staticClass:"image-medium",attrs:{src:e.pushFHImages.body[e.image_count/2+s-1].src},on:{click:function(t){return e.look(e.pushFHImages.body[e.image_count/2+s-1])}}}):e._e()])])})),1)],1),t("el-row",{staticClass:"img_list_bottom"},[t("el-col",{staticClass:"fp_img_col",attrs:{span:2}},[t("div",{staticClass:"type_text_fh"},[e._v("人形")])]),t("el-col",{staticClass:"fp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"fp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-medium"},[""==e.pushFHImages.body[e.image_count+s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushFHImages.body[e.image_count+s-1].src?t("img",{staticClass:"image-medium",attrs:{src:e.pushFHImages.body[e.image_count+s-1].src},on:{click:function(t){return e.look(e.pushFHImages.body[e.image_count+s-1])}}}):e._e()])])})),1),t("el-col",{staticClass:"fp_img_col",attrs:{span:11}},e._l(e.image_count/2,(function(s){return t("el-col",{key:s,staticClass:"fp_img_col",attrs:{span:3}},[t("div",{staticClass:"image-medium"},[""==e.pushFHImages.body[e.image_count/2+e.image_count+s-1].src?t("i",{staticClass:"el-icon-picture-outline"}):e._e(),""!=e.pushFHImages.body[e.image_count/2+e.image_count+s-1].src?t("img",{staticClass:"image-medium",attrs:{src:e.pushFHImages.body[e.image_count/2+e.image_count+s-1].src},on:{click:function(t){return e.look(e.pushFHImages.body[e.image_count/2+e.image_count+s-1])}}}):e._e()])])})),1)],1)],1),t("div",{directives:[{name:"show",rawName:"v-show",value:e.showViewer,expression:"showViewer"}],staticClass:"view_container"},[t("el-dialog",{attrs:{visible:e.showViewer,width:"800px","before-close":e.handleViewerClose},on:{"update:visible":function(t){e.showViewer=t}}},[t("span",{staticClass:"dialog-title",attrs:{slot:"title"},slot:"title"},[e._v(" "+e._s(e.image_types[e.viewerImg.type]+"详细信息-"+e.viewerImg.date)+" ")]),t("el-row",{staticClass:"view_image_info_container"},[t("el-col",{staticClass:"view_image_col",attrs:{span:12}},[t("el-image",{staticClass:"image-view",attrs:{src:e.viewerImg.src,"preview-src-list":[e.viewerImg.src],fit:"fill"}},[t("div",{staticClass:"image-slot-large",attrs:{slot:"error"},slot:"error"},[t("i",{staticClass:"el-icon-picture-outline"})])])],1),t("el-col",{staticClass:"info_col",attrs:{span:12}},[t("div",{staticClass:"view_info_container"},[t("div",{staticClass:"view_info_text"},[e._v(" 视频源： "+e._s(e.viewerImg.snsId)+" ")]),t("div",{directives:[{name:"show",rawName:"v-show",value:3==e.viewerImg.type&&"facehuman"==e.detect_mode,expression:"viewerImg.type == 3 && detect_mode == 'facehuman'"}],staticClass:"view_info_text"},[e._v(" 性别： "+e._s(e.viewerImg.info.gender)+" ")]),t("div",{directives:[{name:"show",rawName:"v-show",value:3==e.viewerImg.type&&"facehuman"==e.detect_mode,expression:"viewerImg.type == 3 && detect_mode == 'facehuman'"}],staticClass:"view_info_text"},[e._v(" 年龄： "+e._s(e.viewerImg.info.age)+" ")]),t("div",{directives:[{name:"show",rawName:"v-show",value:3==e.viewerImg.type&&"facehuman"==e.detect_mode,expression:"viewerImg.type == 3 && detect_mode == 'facehuman'"}],staticClass:"view_info_text"},[e._v(" 口罩： "+e._s(e.viewerImg.info.mask)+" ")]),t("div",{directives:[{name:"show",rawName:"v-show",value:4==e.viewerImg.type&&"hvcfp"==e.detect_mode,expression:"viewerImg.type == 4 && detect_mode == 'hvcfp'"}],staticClass:"view_info_text"},[e._v(" 车牌号码："+e._s(e.viewerImg.info.number)+" ")]),t("div",{directives:[{name:"show",rawName:"v-show",value:4==e.viewerImg.type&&"hvcfp"==e.detect_mode,expression:"viewerImg.type == 4 && detect_mode == 'hvcfp'"}],staticClass:"view_info_text"},[e._v(" 车牌颜色："+e._s(e.viewerImg.info.color)+" ")]),t("div",{directives:[{name:"show",rawName:"v-show",value:"facehuman"==e.detect_mode&&3!=e.viewerImg.type||"hvcfp"==e.detect_mode&&4!=e.viewerImg.type,expression:"detect_mode == 'facehuman' && viewerImg.type != 3 || detect_mode == 'hvcfp' && viewerImg.type != 4"}],staticClass:"view_info_text"},[e._v(" 无属性信息 ")])])])],1)],1)],1)],1)],1)},n=[];s(7658),s(541),s(1439),s(7585),s(5315),s(6229),s(7330),s(2062);function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function r(e,t){if("object"!==o(e)||null===e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var i=s.call(e,t||"default");if("object"!==o(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function c(e){var t=r(e,"string");return"symbol"===o(t)?t:String(t)}function l(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,c(i.key),i)}}function m(e,t,s){return t&&l(e.prototype,t),s&&l(e,s),Object.defineProperty(e,"prototype",{writable:!1}),e}function p(e,t,s){return t=c(t),t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function d(e,t){for(var s=new Float32Array(t),i=0,n=0;i<e.length;n+=e[i].length,i+=1)s.set(e[i],n);return s}function h(e,t,s){if(t<s)throw new Error('Invalid parameter: "inputSampleRate" must be greater than "outputSampleRate"');var i=e.length;t+=0,s+=0;for(var n=t/s,a=Math.ceil(i*s/t),o=new Float32Array(a),r=0,c=0;c<a;c+=1)o[c]=e[Math.floor(r)],r+=n;return o}function u(e,t){if(-1===[8,16].indexOf(t))throw new Error('Invalid parameter: "sampleBits" must be 8 or 16');for(var s=e.length*(t/8),i=new ArrayBuffer(s),n=new DataView(i),a=0,o=0;a<e.length;a+=1,o+=t/8){var r=Math.max(-1,Math.min(1,e[a])),c=r<0?32768*r:32767*r;8===t?n.setInt8(o,parseInt(255/(65535/(c+32768)),10),!0):n.setInt16(o,c,!0)}return n.buffer}function f(e,t,s){if(-1===[8,16].indexOf(t))throw new Error('Invalid parameter: "sampleBits" must be 8 or 16');var i=e.length*(t/8),n=new ArrayBuffer(44+i),a=new DataView(n),o=1,r=0,c=function(e){for(var t=0;t<e.length;t+=1)a.setUint8(r+t,e.charCodeAt(t))};c("RIFF"),r+=4,a.setUint32(r,36+i,!0),r+=4,c("WAVE"),r+=4,c("fmt "),r+=4,a.setUint32(r,16,!0),r+=4,a.setUint16(r,1,!0),r+=2,a.setUint16(r,o,!0),r+=2,a.setUint32(r,s,!0),r+=4,a.setUint32(r,o*s*(t/8),!0),r+=4,a.setUint16(r,o*(t/8),!0),r+=2,a.setUint16(r,t,!0),r+=2,c("data"),r+=4,a.setUint32(r,i,!0),r+=4;for(var l=0;l<e.length;l+=1,r+=t/8){var m=Math.max(-1,Math.min(1,e[l])),p=m<0?32768*m:32767*m;8===t?a.setInt8(r,parseInt(255/(65535/(p+32768)),10),!0):a.setInt16(r,p,!0)}return new Blob([a],{type:"audio/wav"})}function g(){void 0!==window&&void 0!==navigator&&(void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(e){var t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return t?new Promise((function(s,i){t.call(navigator,e,s,i)})):Promise.reject(new Error("getUserMedia is not implemented in this environment"))}))}var _={recordable:!0,sampleRate:16e3,sampleBits:16,bufferSize:16384},v={READY:0,RECORDING:1},w={RAW:"raw",PCM:"pcm",WAV:"wav"},I=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_,s=t.recordable,i=void 0===s?_.recordable:s,n=t.bufferSize,o=void 0===n?_.bufferSize:n,r=t.sampleRate,c=void 0===r?_.sampleRate:r,l=t.sampleBits,m=void 0===l?_.sampleBits:l;a(this,e),p(this,"state",v.READY),p(this,"ctx",new(window.AudioContext||window.webkitAudioContext)),p(this,"sampleRate",_.sampleRate),p(this,"sampleBits",_.sampleBits),p(this,"recordable",_.recordable),p(this,"recorder",null),p(this,"source",null),p(this,"stream",null),p(this,"buffer",[]),p(this,"bufferSize",0);var d=this.ctx,h=d.createScriptProcessor||d.createJavaScriptNode;this.recorder=h.call(d,o,1,1),this.recordable=i,this.sampleRate=c,this.sampleBits=m}return m(e,[{key:"start",value:function(e){var t=this;return this.ctx.resume(),new Promise((function(s,i){navigator.mediaDevices.getUserMedia({audio:!0}).then((function(i){var n=t.recorder,a=t.ctx.createMediaStreamSource(i);t.stream=i,t.source=a,n.onaudioprocess=function(s){var i=s.inputBuffer.getChannelData(0);t.recordable&&(t.buffer.push(i.slice(0)),t.bufferSize+=i.length),"function"===typeof e&&e(i)},a.connect(n),n.connect(t.ctx.destination),t.state=v.RECORDING,s(i)}))["catch"]((function(e){i(e)}))}))}},{key:"pause",value:function(){this.stream.getAudioTracks()[0].stop(),this.recorder.disconnect(),this.source.disconnect(),this.ctx.suspend(),this.state=v.READY}},{key:"clear",value:function(){this.buffer=[],this.bufferSize=0}},{key:"getRecord",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{encodeTo:w.RAW,compressible:!1},t=e.encodeTo,s=void 0===t?w.RAW:t,i=e.compressible,n=void 0!==i&&i;if(this.recordable){var a=d(this.buffer,this.bufferSize),o=this.ctx.sampleRate;n=n&&this.sampleRate<o;var r=n?this.sampleRate:o;switch(n&&(a=h(a,o,r)),s){case w.RAW:return a;case w.PCM:return u(a,this.sampleBits);case w.WAV:return f(a,this.sampleBits,r);default:throw new Error('Invalid parameter: "encodeTo" must be ENCODE_TYPE')}}throw new Error('Configuration error: "recordable" must be set to true')}}]),e}();g();var b=I,y=s(4053),C=s.n(y),O=s(577),k=s.n(O),S=s(3162),F={props:["mode_option","preview_sns_mode"],data(){return{image_count:16,detect_mode:"hvcfp",pushFHImages:{face:[],body:[]},pushHCVFPImages:{face:[],body:[],vechicle:[],cycle:[],plate:[]},currentImg:{snsId:0,type:0,src:"",date:"",info:{age:"--",gender:"--",mask:"--",info:"--",number:"--",color:"--"}},viewerImg:{snsId:0,type:0,src:"",date:"",info:{age:"--",gender:"--",mask:"--",info:"--",number:"--",color:"--"}},eventList:[],image_types:["人形","机动车","非机动车","人脸","车牌","抓拍","爆闪"],genderOptions:["女","男"],respiratorOptions:{no_respirator:"未配戴",surgical:"医用口罩","anti-pollution":"防雾霾口罩",common:"已佩戴",kitchen_transparent:"厨房透明口罩",unknown:"未知"},plateColorOptions:{blue:"蓝色",yellow:"黄色",black:"黑色",white:"白色",green:"绿色",small_new_energy:"新能源",large_new_energy:"新能源",absence:"未知",unknown:"未知"},sizeOptions:[{id:0,label:"自适应",value:"0:0",icon:"el-icon-full-screen"},{id:1,label:"原比例",value:"1:1",icon:"el-icon-full-screen"}],sns_num:2,streamOptions:[{streamInd:0,sizeOptionInd:1,recEnable:!1,isRecStart:!1,isWfsError:!1,showVideoStatus:!1,wfsObj:null,encInfo:"",timerEncInfo:void 0,recIcon:"iconfont icon-record-start",videoInfo:[{id:0,label:"主码流0",icon:"el-icon-full-screen",mediaType:"H264Raw",mediaFPS:25,enable:1},{id:1,label:"子码流1",icon:"el-icon-full-screen",mediaType:"H264Raw",mediaFPS:25,enable:1},{id:2,label:"子码流2",icon:"el-icon-full-screen",mediaType:"H264Raw",mediaFPS:25,enable:1}],mjpegCtx:{isDrawImg:!0,mjpegW:0,mjpegH:0,sizeOptionInd:1,getObjectFitSize:this.getObjectFitSize,timerDraw:void 0},trigger_attr:{trigger_enable:!1,trigger:!1}},{streamInd:0,sizeOptionInd:1,recEnable:!1,isRecStart:!1,isWfsError:!1,showVideoStatus:!1,wfsObj:null,encInfo:"",timerEncInfo:void 0,recIcon:"iconfont icon-record-start",videoInfo:[{id:0,label:"主码流0",icon:"el-icon-full-screen",mediaType:"H264Raw",mediaFPS:25,enable:1},{id:1,label:"子码流1",icon:"el-icon-full-screen",mediaType:"H264Raw",mediaFPS:25,enable:1},{id:2,label:"子码流2",icon:"el-icon-full-screen",mediaType:"H264Raw",mediaFPS:25,enable:1}],mjpegCtx:{mjpeg_w:0,mjpeg_h:0,sizeOptionInd:1,getObjectFitSize:this.getObjectFitSize,isDrawImg:!0,timerDraw:void 0}}],sns0CurDisplayMediaType:0,screenIcon:"iconfont icon-fullscreen-enter",isAiEnable:!1,isSearchImg:!1,isFullScreen:!1,isForceStop:!1,ezoomEnable:!1,aenc_enable:!1,aenc_type:"aac",aenc_sample_rate:16e4,aenc_num_channels:1,isTalking:!1,isMuted:!0,is3ASyncOn:!0,wsPushImage:null,timerPushImage:void 0,wsSnapshot:null,timerSnapshot:void 0,wsEvents:null,timerEvents:void 0,curImgInd:{fh:[0,0],hcvfp:[0,0,0,0,0]},max_try_num:3,showViewer:!1,full_scr_id:void 0,ezoomMouseDown:[!1,!1],ezoom:[{ezoom_ratio:1,center_offset_x:0,center_offset_y:0,max_ratio:8,step:.1},{ezoom_ratio:1,center_offset_x:0,center_offset_y:0,max_ratio:8,step:.1}],snsOptLeft:{snsOptInd:0,snsInfo:[{id:0,label:"CAM0",icon:"el-icon-full-screen"}]}}},created(){console.log("preview created ++"),this.getInfo(!1,0),this.startPushImage(),this.startSnapshot(),this.startRecvEvents();for(var e=0;e<this.image_count;e++)this.pushFHImages.face.push({snsId:0,type:3,src:"",date:"",info:{gender:"--",age:"--",mask:"--",info:"--"}}),this.pushFHImages.face.push({snsId:0,type:3,src:"",date:"",info:{gender:"--",age:"--",mask:"--",info:"--"}}),this.pushFHImages.body.push({snsId:0,type:0,src:"",date:"",info:{}}),this.pushFHImages.body.push({snsId:0,type:0,src:"",date:"",info:{}}),this.pushHCVFPImages.face.push({snsId:0,type:3,src:"",date:"",info:{}}),this.pushHCVFPImages.body.push({snsId:0,type:0,src:"",date:"",info:{}}),this.pushHCVFPImages.vechicle.push({snsId:0,type:1,src:"",date:"",info:{}}),this.pushHCVFPImages.cycle.push({snsId:0,type:2,src:"",date:"",info:{}}),this.pushHCVFPImages.plate.push({snsId:0,type:4,src:"",date:"",info:{number:"--",color:"--"}});this.$nextTick((function(){this.resizeCanvas()})),console.log("preview created --")},mounted(){console.log("preview mounted ++");const e=this;k().isEnabled&&k().on("change",(()=>{e.checkFull()})),window.addEventListener("visibilitychange",(()=>{if("visible"===document.visibilityState)for(var e=0;e<this.streamOptions.length;e++)this.streamOptions[e].wfsObj&&this.streamOptions[e].showVideoStatus&&this.streamOptions[e].wfsObj.playerSeekNow();else this.onStopTalk()})),console.log("preview mounted --")},destroyed(){this.stopMedia(),this.onStopTalk(),this.stopPushImage(),this.stopSnapshot(),this.stopRecvEvents(),k().off("change",(()=>{}))},methods:{startMedia(){this.isForceStop=!1,this.startPlay()},stopMedia(){this.isForceStop=!0;for(var e=0;e<this.sns_num;e++)this.stopEncInfoQuery(e),this.stop(e)},async startPlay(){let e=this.snsOptLeft.snsInfo[this.snsOptLeft.snsOptInd].id;await this.startSensorPlay(e),this.sns_num>=2&&await this.startSensorPlay(1)},startSensorPreview(e){this.isForceStop=!1,this.startSensorPlay(e)},stopSensorPreview(e){this.isForceStop=!0,this.stopEncInfoQuery(e),this.stop(e)},async startSensorPlay(e){for(var t=!1,s=0;s<this.max_try_num;s++){if(t)break;try{await this.changeStream(e,this.streamOptions[e].streamInd,!0,!0),t=!0}catch(i){t=!1,s==this.max_try_num-1&&console.log("startSensorPlay catch except: "+i)}}t||this.$message.error("网络请求码流失败")},play(e){console.log("play++, snsid: "+e);try{this.stop(e);const t=window.sessionStorage.getItem("token");if(!t)return void console.log("play--, snsid: "+e+",token is empty");let s=this.streamOptions[e].sizeOptionInd,i=this.streamOptions[e].streamInd,n=this.streamOptions[e].videoInfo[i].id,a=this.streamOptions[e].videoInfo[i].mediaFPS;if(this.changeSizeOption(e,s),!this.streamOptions[e].videoInfo[i].enable)return void console.log("play--, snsid: "+e+", streamInd"+i+", is disabled!");if(C().isSupported()){let s={wsMinPacketInterval:2e3,wsMaxPacketInterval:8e3,fps:a,liveMaxLatency:.5},i=this.getDisplayInfo(e);console.log("new wfs obj, sns id: "+e+", mediaType: "+i.mediaType),this.streamOptions[e].wfsObj=new(C())(s);let o={video:i.video,ctx:i.mjpeg},r=null;this.aenc_enable&&0==e&&"MJPEG"!=i.mediaType&&(r={websocketName:"ws/audio_"+e+"?token="+t,mediaType:this.aenc_type,sampleRate:this.aenc_sample_rate,numChannels:this.aenc_num_channels,bitWidth:this.aenc_bit_width}),0==e&&(this.sns0CurDisplayMediaType=i.mediaType),this.streamOptions[e].wfsObj.attachMedia(o,"ch"+e,i.mediaType,"ws/preview?token="+t+"&&sns_id="+e+"&&chn_id="+n,i.extra,r),this.streamOptions[e].wfsObj.on(C().Events.ERROR,((t,s)=>this.handleWfsEvent(e,t,s))),this.streamOptions[e].isRecStart&&i.showVideo&&(this.streamOptions[e].isRecStart=!1,this.onRecording(e)),"MJPEG"==i.mediaType&&this.resizeCanvas(),this.startEncInfoQuery(e)}else console.log("wfs is not supported")}catch(t){console.log("play catch except: "+t)}console.log("play--, snsId: "+e)},stop(e){console.log("stop++, sns id: "+e),null!=this.streamOptions[e].wfsObj&&(this.streamOptions[e].isRecStart&&(this.streamOptions[e].wfsObj.stop_recording(),this.streamOptions[e].isWfsError||(this.streamOptions[e].isRecStart=!1,this.streamOptions[e].recIcon="iconfont icon-record-start")),this.streamOptions[e].wfsObj.destroy(),this.streamOptions[e].wfsObj=null),console.log("stop--, sns id: "+e)},getMediatype(e){return 0===e?"H264Raw":1===e?"MJPEG":2===e?"H265Raw":"H264Raw"},getDisplayInfo(e){const t=[document.getElementById("myVideo0"),document.getElementById("myVideo1")],s=[document.getElementById("myMjpeg0"),document.getElementById("myMjpeg1")];let i=this.streamOptions[e].streamInd,n=this.streamOptions[e].videoInfo[i].mediaType;this.streamOptions[e].mjpegCtx.sizeOptionInd=this.streamOptions[e].sizeOptionInd;let a=this.streamOptions[e].mjpegCtx,o=C().canPlayByVideo(n);return this.streamOptions[e].showVideoStatus=o,{video:t[e%2],mjpeg:s[e%2],mediaType:n,extra:a,showVideo:o}},changeSizeOption0(e){this.changeSizeOption(this.snsOptLeft.snsInfo[this.snsOptLeft.snsOptInd].id,Number(e))},changeSizeOption1(e){this.changeSizeOption(1,Number(e))},changeSizeOption(e,t){const s=[document.getElementById("myVideo0"),document.getElementById("myVideo1")];this.streamOptions[e].sizeOptionInd=t,0===this.streamOptions[e].sizeOptionInd?s[e%2].style.setProperty("object-fit","fill","important"):s[e%2].style.setProperty("object-fit","contain","important"),console.log("sns "+e+" old objectFit: ",s[e%2].style.objectFit),this.streamOptions[e].mjpegCtx.sizeOptionInd=this.streamOptions[e].sizeOptionInd,window.localStorage.setItem("size_"+e,this.streamOptions[e].sizeOptionInd)},async changeStream0(e,t=!0,s=!0){await this.changeStream(this.snsOptLeft.snsInfo[this.snsOptLeft.snsOptInd].id,Number(e),t,s)},async changeStream1(e,t=!0,s=!0){await this.changeStream(1,Number(e),t,s)},async changeStream(e,t,s=!0,i=!0){if(console.log("video "+e+" change stream to "+this.streamOptions[e].videoInfo[t].id),i){this.streamOptions[e].streamInd=t;let s=this.streamOptions[e].videoInfo[t].mediaType;this.streamOptions[e].recEnable=C().canPlayByVideo(s),window.localStorage.setItem("stream_"+e,this.streamOptions[e].videoInfo[t].id)}this.clearEncInfo(e),s&&this.play(e)},async changeSnsOptLeft(e){let t=this.snsOptLeft.snsInfo[this.snsOptLeft.snsOptInd].id;this.stop(t),this.stopEncInfoQuery(t);let s=this.streamOptions[t].streamInd,i=Number(e);console.log("changesnsOptLeft sns id: "+i+" stream id: "+s);for(var n=0;n<this.snsOptLeft.snsInfo.length;n++)if(i==this.snsOptLeft.snsInfo[n].id){this.snsOptLeft.snsOptInd=n,window.localStorage.setItem("snsOptLeftInd",n);break}await this.changeStream(i,s,!0,!0)},async recordFaceinfo(e){console.log("record faceinfo, sns id: "+e),this.stop(e);const{data:t}=await this.$http.post("preview/faceinfo",{src_id:e,faceinfo:!0});return this.play(e),console.log("post record faceinfo: ",t),200!==t.meta.status?this.$message.error("人像信息录入失败"):0==t.data.faceinfo.status?this.$message.success("人像信息录入成功"):2==t.data.faceinfo.status?this.$message.warning("不支持此功能"):3==t.data.faceinfo.status?this.$message.warning("数据加载中，请稍后再试"):this.$message.error("人像信息录入失败，请重试")},initStreamOptions(e){for(var t=2;t<e;t++){var s=Object.assign({},this.streamOptions[0]);this.streamOptions.push(s)}},initSensorOptInd(e){var t=window.localStorage.getItem("snsOptLeftInd");void 0==t||e<3?this.snsOptLeft.snsOptInd=0:(t=parseInt(t),this.snsOptLeft.snsOptInd=t>1?0:t)},async getInfo(e,t){try{const l=window.sessionStorage.getItem("token");if(!l)return;const{data:m}=await this.$http.get("preview/info");if(console.log("preview info get return: ",m),200===m.meta.status){this.sns_num=m.data.info.sns_num,this.initStreamOptions(this.sns_num),this.snsOptLeft.snsInfo.splice(1);for(var s=0;s<this.sns_num;s++){this.streamOptions[s].videoInfo=[];for(var i=0;i<m.data.info.stream_list[s].length;i++){var n=m.data.info.stream_list[s][i],a={id:n,label:0===n?"主码流0":"子码流"+n,icon:"el-icon-full-screen",mediaType:this.getMediatype(m.data.info.sns_codec[s][i]),mediaFPS:m.data.info.sns_video_fps[s][i],enable:m.data.info.stream_list_enable[s][i]};this.streamOptions[s].videoInfo.push(a),0==s&&(this.streamOptions[s].trigger_attr.trigger_enable=m.data.info.trigger_enable)}if(s>=2&&s%2==0){a={id:s,label:"CAM"+s,icon:"el-icon-full-screen"};this.snsOptLeft.snsInfo.push(a)}a={ezoom_ratio:m.data.info.ezoom[s].ezoom_ratio,center_offset_x:m.data.info.ezoom[s].center_offset_x,center_offset_y:m.data.info.ezoom[s].center_offset_y,max_ratio:m.data.info.ezoom[s].max_ratio,step:m.data.info.ezoom[s].step};s<this.ezoom.length?this.ezoom.splice(s,1,a):this.ezoom.splice(s,0,a)}this.initSensorOptInd(this.sns_num),this.ezoomEnable=m.data.info.ezoom_enable,this.aenc_enable=m.data.info.aenc_enable,this.aenc_type=m.data.info.aenc_type,this.aenc_sample_rate=m.data.info.aenc_sample_rate,this.aenc_bit_width=m.data.info.aenc_bit_width,this.isSearchImg=m.data.info.searchimg,this.isAiEnable=m.data.info.ai_enable,this.detect_mode=m.data.info.detect_mode,console.log("1detect_mode: "+this.detect_mode),this.detect_mode||(this.detect_mode="facehuman",console.log("set detect_mode to default: "+this.detect_mode));for(var o=0;o<this.sns_num;o++){var r=window.localStorage.getItem("stream_"+o),c=m.data.info.stream_list[o].length-1;void 0==r?this.streamOptions[o].streamInd=Math.min(1,c):(r=parseInt(r),this.streamOptions[o].streamInd=r>c?Math.min(1,c):r),r=window.localStorage.getItem("size_"+o),this.streamOptions[o].sizeOptionInd=void 0==r?0:parseInt(r),this.streamOptions[o].mjpegCtx.sizeOptionInd=this.streamOptions[o].sizeOptionInd,this.streamOptions[o].showVideoStatus=C().canPlayByVideo(this.streamOptions[o].videoInfo[this.streamOptions[o].streamInd].mediaType),this.streamOptions[o].recEnable=!!this.streamOptions[o].showVideoStatus}console.log("this.sns_num:"+this.sns_num),e?this.startSensorPreview(t):this.startMedia()}}catch(l){console.log("getInfo exception: "+l),this.$message.error("获取信息失败")}},recResultCallback0(e){this.streamOptions[0].recEnable=!0,e?(this.streamOptions[0].isRecStart=!0,this.streamOptions[0].recIcon="iconfont icon-record-stop"):this.$message.error("Cam0开启录像失败")},recResultCallback1(e){this.streamOptions[1].recEnable=!0,e?(this.streamOptions[1].isRecStart=!0,this.streamOptions[1].recIcon="iconfont icon-record-stop"):this.$message.error("Cam1开启录像失败")},recResultCallback2(e){this.streamOptions[2].recEnable=!0,e?(this.streamOptions[2].isRecStart=!0,this.streamOptions[2].recIcon="iconfont icon-record-stop"):this.$message.error("Cam2开启录像失败")},recStateCallback0(e){this.streamOptions[0].recEnable=e},recStateCallback1(e){this.streamOptions[1].recEnable=e},recStateCallback2(e){this.streamOptions[2].recEnable=e},async onSnapshot(e){let t=this.streamOptions[e].videoInfo[this.streamOptions[e].streamInd].id;try{const{data:s}=await this.$http.post("preview/snapshot",{src_id:e,stream:t});200===s.meta.status&&console.log("send snapshot cmd success")}catch(s){console.log("onSnapshot exception: "+s),this.$message.error("发送抓拍命令失败")}},onEZoomMousedown(e){this.ezoomMouseDown[e]=!0,window.onmouseup=()=>{this.ezoomMouseDown[e]=!1,window.onmouseup=null}},async onEZoom(e){if(!this.ezoomMouseDown[e])return;const t=window.sessionStorage.getItem("token");if(!t)return;let s=this.streamOptions[e].videoInfo[this.streamOptions[e].streamInd].id;try{const{data:t}=await this.$http.post("preview/ezoom",{src_id:e,stream:s,ezoom:this.ezoom[e]});console.log("ezoom get return: ",t),200===t.meta.status&&console.log("send ezoom cmd success")}catch(i){}},async ZoomIn(e,t){this.ezoom[e].ezoom_ratio+t>this.max_ezoom_ratio_0?this.ezoom[e].ezoom_ratio=this.ezoom[e].max_ratio:this.ezoom[e].ezoom_ratio=parseFloat((this.ezoom[e].ezoom_ratio+t).toFixed(1)),this.ezoomMouseDown[e]=!0},async ZoomOut(e,t){this.ezoom[e].ezoom_ratio-t<1?this.ezoom[e].ezoom_ratio=1:this.ezoom[e].ezoom_ratio=parseFloat((this.ezoom[e].ezoom_ratio-t).toFixed(1)),this.ezoomMouseDown[e]=!0},async onRecording(e){if(this.streamOptions[e].wfsObj){var t=this.streamOptions[e].isRecStart;if(t)this.streamOptions[e].wfsObj.stop_recording(),this.streamOptions[e].isRecStart=!1,this.streamOptions[e].recIcon="iconfont icon-record-start";else{this.streamOptions[e].recEnable=!1;var s=window.localStorage.getItem("rec_threshold_web");void 0==s&&(s=1024),console.log("sns["+e+"] recording - threshold: "+s+" MB"),this.streamOptions[e].wfsObj.start_recording(1024*s*1024,0===e?this.recResultCallback0:1===e?this.recResultCallback1:this.recResultCallback2,0===e?this.recStateCallback0:1===e?this.recStateCallback1:this.recStateCallback2)}}},async getEncInfo(e){try{const t=window.sessionStorage.getItem("token");if(!t)return;let s=this.streamOptions[e].videoInfo[this.streamOptions[e].streamInd].id,i=this.streamOptions[e].videoInfo[this.streamOptions[e].streamInd].mediaType;const{data:n}=await this.$http.get("preview/assist",{params:{src_id:e,stream:s}});if(200===n.meta.status){let t="";switch(i){case"MJPEG":t="MJPEG";break;case"H265Raw":t="H265";break;case"H264Raw":default:t="H264";break}this.streamOptions[e].encInfo="CAM"+e+"  编码格式: "+t+"  分辨率: "+n.data.assist_res+"  码率: "+n.data.assist_bitrate}}catch(t){}},async clearEncInfo(e){this.streamOptions[e].encInfo=""},async onStartTalk(){const e=window.sessionStorage.getItem("token");e&&(this.isTalking?this.onStopTalk():(this.startAudioComm(),this.isForceStopTalk=!1,this.rc||(this.rc=new b({recordable:!0,sampleRate:this.aenc_sample_rate,sampleBits:8*(this.aenc_bit_width+1),bufferSize:4096})),this.rc&&this.rc.state===v.READY&&(this.isTalking=!0,this.rc.clear(),this.rc.start((e=>{if(this.isTalking){const e=this.rc.getRecord({encodeTo:w.PCM,compressible:!0});this.rc.clear();let t=this.wsTalk;this.isTalking&&t&&t.readyState===WebSocket.OPEN&&e&&e.byteLength&&t.send(e)}})).then((()=>{console.log("start talk")})).catch((e=>{console.log("talk failed.",e)})))))},async onStopTalk(){this.isForceStopTalk=!0,this.rc&&this.rc.state===v.RECORDING&&this.rc.pause(),this.isTalking&&(this.stopAudioComm(),this.isTalking=!1,this.rc=null,console.log("stop talk"))},async onMute(){this.isMuted=!this.isMuted;var e=document.getElementById("myVideo0");e.muted=this.isMuted},startEncInfoQuery(e){this.stopEncInfoQuery(e),this.streamOptions[e].timerEncInfo=setInterval((()=>{this.getEncInfo(e)}),1e3)},stopEncInfoQuery(e){this.streamOptions[e].timerEncInfo&&(clearInterval(this.streamOptions[e].timerEncInfo),this.streamOptions[e].timerEncInfo=void 0)},async change3ASync(){console.log("++ enable 3A Sync:"+!this.is3ASyncOn);const{data:e}=await this.$http.post("preview/3a_sync",{sync3a:!this.is3ASyncOn});if(console.log("post enable 3A Sync return: ",e),200!==e.meta.status)return this.$message.error("设置3A Sync状态失败");this.is3ASyncOn=!this.is3ASyncOn,console.log("-- enable 3A Sync:"+this.is3ASyncOn)},doScreen(e){const t=e%2==0?document.getElementById("video_container_0"):document.getElementById("video_container_1");this.isFullScreen?(k().exit(t),this.screenIcon="iconfont icon-fullscreen-enter",this.resumePlay(e)):(k().request(t),this.screenIcon="iconfont icon-fullscreen-exit",this.full_scr_id=e),this.isFullScreen=!this.isFullScreen},checkFull(){k().isFullscreen||(this.isFullScreen=!1,this.screenIcon="iconfont icon-fullscreen-enter",this.resumePlay(0===this.full_scr_id?1:0))},resumePlay(e){this.streamOptions[e].showVideoStatus&&this.streamOptions[e].wfsObj.playerSeekNow()},handleWfsEvent(e,t,s){try{if(s.fatal){switch(this.streamOptions[e].isWfsError=!0,console.warn("sns["+e+"] fatal error :"+s.details),s.type){case C().ErrorTypes.MEDIA_ERROR:console.log("sns["+e+"] a media error occurred");break;case C().ErrorTypes.NETWORK_ERROR:console.log("sns["+e+"] a network error occurred");break;default:console.log("sns["+e+"] an unrecoverable error occurred");break}setTimeout((()=>{this.play(e)}),5e3)}}catch(i){console.log("sns["+e+"] handleWfsEvent catch except: "+i)}},startPushImage(){this.isForceStop=!0,this.stopPushImage(),this.isForceStop=!1;const e=window.sessionStorage.getItem("token");if(e){var t="ws://"+window.location.host+"/ws/pushimage?token="+e,s="binary";this.wsPushImage=new WebSocket(t,s),this.wsPushImage.onopen=()=>{console.log("PushImage connected"),this.createPushImageTimer()},this.wsPushImage.onclose=e=>{console.log("PushImage disconnected",e),this.isForceStop||setTimeout((()=>{this.startPushImage()}),2e3)},this.wsPushImage.onmessage=e=>{if("string"===typeof e.data)console.log("PushImage got a message: "+e.data);else try{let t=new FileReader;t.onload=e=>{e.target.readyState===FileReader.DONE&&this.parseJpgDataWithHead(e.target.result)},t.readAsArrayBuffer(e.data)}catch(t){console.log("PushImage image catch except: "+t)}},this.wsPushImage.onerror=e=>{console.log("PushImage occure error",e)}}},startSnapshot(){this.isForceStop=!0,this.stopSnapshot(),this.isForceStop=!1;const e=window.sessionStorage.getItem("token");if(e){var t="ws://"+window.location.host+"/ws/snapshot?token="+e,s="binary";this.wsSnapshot=new WebSocket(t,s),this.wsSnapshot.onopen=()=>{console.log("Snapshot connected"),this.createSnapshotTimer()},this.wsSnapshot.onclose=e=>{console.log("Snapshot disconnected",e),this.isForceStop||setTimeout((()=>{this.startSnapshot()}),2e3)},this.wsSnapshot.onmessage=e=>{if("string"===typeof e.data)console.log("Snapshot got a message: "+e.data);else try{const t=new Blob([e.data],{type:"image/jpeg"}),s="snapshot_"+this.getCurrentTime()+".jpg";(0,S.saveAs)(t,s)}catch(t){console.log("Snapshot catch except: "+t)}},this.wsSnapshot.onerror=e=>{console.log("Snapshot occure error",e)}}},startAudioComm(){this.wsTalkBufList=[],this.wsTalkBufSize=0;const e=window.sessionStorage.getItem("token");if(e){var t="ws://"+window.location.host+"/ws/talk?token="+e,s="binary";this.wsTalk=new WebSocket(t,s),this.wsTalk.onopen=()=>{console.log("ws talk connected")},this.wsTalk.onclose=e=>{console.log("ws talk disconnected: ",e),this.isForceStopTalk?this.onStopTalk():setTimeout((()=>{this.wsTalk=null,this.startAudioComm()}),1e3)},this.wsTalk.onmessage=e=>{"string"===typeof e.data&&console.log("got a talk message: "+e.data)},this.wsTalk.onerror=e=>{console.log("ws talk occure error: ",e)}}},stopAudioComm(){this.wsTalk&&(this.wsTalk.close(),this.wsTalk=null)},stopPushImage(){this.clearPushImageTimer(),this.wsPushImage&&this.wsPushImage.close()},createPushImageTimer(){this.clearPushImageTimer(),this.timerPushImage=setInterval((()=>{this.wsPushImage&&this.wsPushImage.readyState===WebSocket.OPEN&&this.wsPushImage.send("keep-alive")}),3e3)},clearPushImageTimer(){this.timerPushImage&&(clearInterval(this.timerPushImage),this.timerPushImage=void 0)},stopSnapshot(){this.clearSnapshotTimer(),this.wsSnapshot&&this.wsSnapshot.close()},createSnapshotTimer(){this.clearSnapshotTimer(),this.timerSnapshot=setInterval((()=>{this.wsSnapshot&&this.wsSnapshot.readyState===WebSocket.OPEN&&this.wsSnapshot.send("keep-alive")}),3e3)},clearSnapshotTimer(){this.timerSnapshot&&(clearInterval(this.timerSnapshot),this.timerSnapshot=void 0)},startRecvEvents(){console.log("startRecvEvents ++"),this.isForceStop=!0,this.stopRecvEvents(),this.isForceStop=!1;const e=window.sessionStorage.getItem("token");if(e){var t="ws://"+window.location.host+"/ws/events?token="+e,s="binary";this.wsEvents=new WebSocket(t,s),this.wsEvents.onopen=()=>{console.log("ws events connected"),this.createEventstimer()},this.wsEvents.onclose=e=>{console.log("ws events disconnected",e),this.isForceStop||setTimeout((()=>{this.startRecvEvents()}),2e3)},this.wsEvents.onmessage=e=>{if("string"===typeof e.data)console.log("got a ws events message: "+e.data);else try{let t=new FileReader;t.onload=e=>{if(e.target.readyState===FileReader.DONE){for(var t=JSON.parse(e.target.result),s=0;s<t.events.length;s++)1===t.events[s].type?this.eventList.unshift({type:"移动",date:t.events[s].date,sensor:t.events[s].sensor}):2===t.events[s].type?this.eventList.unshift({type:"遮挡",date:t.events[s].date,sensor:t.events[s].sensor}):3===t.events[s].type?this.eventList.unshift({type:"场景变更",date:t.events[s].date,sensor:t.events[s].sensor}):5===t.events[s].type?this.eventList.unshift({type:"声音检测",date:t.events[s].date,sensor:t.events[s].db+"dB"}):0===t.events[s].type&&(console.log("got a video change event: "+e.target.result),this.resetVideoStream(t.events[s].sensor));this.eventList.length>32&&this.eventList.splice(32,this.eventList.length-32)}},t.readAsText(e.data)}catch(t){console.log("ws events catch except: "+t)}},this.wsEvents.onerror=e=>{console.log("ws events occure error",e)},console.log("startRecvEvents --")}},sleep(e){return new Promise((t=>setTimeout(t,e)))},async resetVideoStream(e){this.stopSensorPreview(e),console.log("sleep 200ms and reset video stream"),await this.sleep(200),this.getInfo(!0,e)},stopRecvEvents(){console.log("stopRecvEvents ++"),this.clearEventstimer(),this.wsEvents&&this.wsEvents.close(),console.log("stopRecvEvents --")},createEventstimer(){this.clearEventstimer(),this.timerEvents=setInterval((()=>{this.wsEvents&&this.wsEvents.readyState===WebSocket.OPEN&&this.wsEvents.send("keep-alive")}),3e3)},clearEventstimer(){this.timerEvents&&(clearInterval(this.timerEvents),this.timerEvents=void 0)},parseJpgDataWithHead(e){try{var t=new Uint8Array(e.slice(0,16));if(t&&65===t[0]&&88===t[1]&&73===t[2]&&84===t[3]){var s=this.bytesToIntLittleEndian(t.subarray(4,8));if(74===t[8]&&83===t[9]&&79===t[10]&&78===t[11]){var i=this.bytesToIntLittleEndian(t.subarray(12,16)),n=new TextDecoder("utf-8"),a=new Uint8Array(e.slice(16,16+i-1)),o=n.decode(a),r=JSON.parse(o),c=new Blob([e.slice(s)],{type:"image/jpeg"}),l=(URL||webkitURL).createObjectURL(c);if(r&&l)if("facehuman"===this.detect_mode){if(3===r.type){var m=this.curImgInd.fh[0];this.pushFHImages.face[m].snsId=r.snsId,this.pushFHImages.face[m].src=l,this.pushFHImages.face[m].date=this.getCurrentTime(),this.pushFHImages.face[m].info.gender=this.genderOptions[r.attribute.face.gender],this.pushFHImages.face[m].info.age=r.attribute.face.age,this.pushFHImages.face[m].info.mask=this.respiratorOptions[r.attribute.face.mask],this.pushFHImages.face[m].info.info=r.attribute.face.info,this.curImgInd.fh[0]=(m+1)%this.pushFHImages.face.length,this.currentImg.snsId=r.snsId,this.currentImg.src=l,this.currentImg.type=3,this.currentImg.date=this.pushFHImages.face[m].date,this.currentImg.info.gender=this.pushFHImages.face[m].info.gender,this.currentImg.info.age=this.pushFHImages.face[m].info.age,this.currentImg.info.mask=this.pushFHImages.face[m].info.mask,this.currentImg.info.info=this.pushFHImages.face[m].info.info}else if(0===r.type){m=this.curImgInd.fh[1];this.pushFHImages.body[m].snsId=r.snsId,this.pushFHImages.body[m].src=l,this.pushFHImages.body[m].date=this.getCurrentTime(),this.pushFHImages.face[m].info={},this.curImgInd.fh[1]=(m+1)%this.pushFHImages.body.length}}else if("hvcfp"===this.detect_mode)if(3===r.type){m=this.curImgInd.hcvfp[0];this.pushHCVFPImages.face[m].snsId=r.snsId,this.pushHCVFPImages.face[m].src=l,this.pushHCVFPImages.face[m].date=this.getCurrentTime(),this.pushHCVFPImages.face[m].info={},this.curImgInd.hcvfp[0]=(m+1)%this.pushHCVFPImages.face.length}else if(0===r.type){m=this.curImgInd.hcvfp[1];this.pushHCVFPImages.body[m].snsId=r.snsId,this.pushHCVFPImages.body[m].src=l,this.pushHCVFPImages.body[m].date=this.getCurrentTime(),this.pushHCVFPImages.body[m].info={},this.curImgInd.hcvfp[1]=(m+1)%this.pushHCVFPImages.body.length}else if(1===r.type){m=this.curImgInd.hcvfp[2];this.pushHCVFPImages.vechicle[m].snsId=r.snsId,this.pushHCVFPImages.vechicle[m].src=l,this.pushHCVFPImages.vechicle[m].date=this.getCurrentTime(),this.pushHCVFPImages.vechicle[m].info={},this.curImgInd.hcvfp[2]=(m+1)%this.pushHCVFPImages.vechicle.length}else if(2===r.type){m=this.curImgInd.hcvfp[3];this.pushHCVFPImages.cycle[m].snsId=r.snsId,this.pushHCVFPImages.cycle[m].src=l,this.pushHCVFPImages.cycle[m].date=this.getCurrentTime(),this.pushHCVFPImages.cycle[m].info={},this.curImgInd.hcvfp[3]=(m+1)%this.pushHCVFPImages.cycle.length}else if(4===r.type){m=this.curImgInd.hcvfp[4];this.pushHCVFPImages.plate[m].snsId=r.snsId,this.pushHCVFPImages.plate[m].src=l,this.pushHCVFPImages.plate[m].date=this.getCurrentTime(),this.pushHCVFPImages.plate[m].info.number=r.attribute.plate.number,this.pushHCVFPImages.plate[m].info.color=this.plateColorOptions[r.attribute.plate.color],this.curImgInd.hcvfp[4]=(m+1)%this.pushHCVFPImages.plate.length,this.currentImg.snsId=r.snsId,this.currentImg.src=l,this.currentImg.type=4,this.currentImg.date=this.pushHCVFPImages.plate[m].date,this.currentImg.info.number=this.pushHCVFPImages.plate[m].info.number,this.currentImg.info.color=this.pushHCVFPImages.plate[m].info.color}}}}catch(p){console.log("ws parse jpg with header catch except: "+p)}},refreshMjpegCanvas(e){var t=document.getElementById(0==e?"myMjpeg0":"myMjpeg1");t&&(this.streamOptions[e].mjpegCtx.mjpeg_w=0==e?this.$refs.axMain0.$el.offsetWidth:this.$refs.axMain1.$el.offsetWidth,this.streamOptions[e].mjpegCtx.mjpeg_h=0==e?this.$refs.axMain0.$el.offsetHeight:this.$refs.axMain1.$el.offsetHeight,t.setAttribute("width",this.streamOptions[e].mjpegCtx.mjpeg_w),t.setAttribute("height",this.streamOptions[e].mjpegCtx.mjpeg_h),console.log("sns["+e+"]: canvas_w="+this.streamOptions[e].mjpegCtx.mjpeg_w+",canvas_h="+this.streamOptions[e].mjpegCtx.mjpeg_h),this.streamOptions[e].mjpegCtx.isDrawImg=!1,this.streamOptions[e].mjpegCtx.timerDraw&&clearInterval(this.streamOptions[e].mjpegCtx.timerDraw),this.streamOptions[e].mjpegCtx.timerDraw=setInterval((()=>{this.streamOptions[e].mjpegCtx.isDrawImg=!0,clearInterval(this.streamOptions[e].mjpegCtx.timerDraw)}),300))},resizeCanvas(){this.refreshMjpegCanvas(0),this.refreshMjpegCanvas(1)},getObjectFitSize(e=0,t,s,i,n){let a=1,o=0,r=0,c=i,l=n,m=0,p=0,d=t,h=s,u=t/s,f=i/n;return 0===e?f>=u?(a=s/n,o=(i-t/a)/2,c=t/a,l=n):(a=t/i,r=(n-s/a)/2,c=i,l=s/a):1===e&&(f>=u?(a=t/i,p=(s-n*a)/2,h=n*a):(a=s/n,m=(t-i*a)/2,d=i*a)),{sx:o,sy:r,swidth:c,sheight:l,x:m,y:p,width:d,height:h}},getCurrentTime(){var e=new Date,t=this.zeroFill(e.getMonth()+1),s=this.zeroFill(e.getDate()),i=this.zeroFill(e.getHours()),n=this.zeroFill(e.getMinutes()),a=this.zeroFill(e.getSeconds()),o=e.getMilliseconds();o<=9?o="00"+o:o<=99&&(o="0"+o);var r=e.getFullYear()+"-"+t+"-"+s+" "+i+":"+n+":"+a+"."+o;return r},zeroFill(e){return e>=0&&e<=9?"0"+e:e},bytesToIntLittleEndian(e){for(var t=0,s=e.length-1;s>=0;s--)t+=e[s],0!=s&&(t<<=8);return t},handleViewerClose(){this.showViewer=!1},look(e){("facehuman"===this.detect_mode&&3===e.type||"hvcfp"===this.detect_mode&&4===e.type)&&(this.currentImg.snsId=e.snsId,this.currentImg.type=e.type,this.currentImg.src=e.src,this.currentImg.date=e.date,this.currentImg.info.age=e.info.age,this.currentImg.info.gender=e.info.gender,this.currentImg.info.mask=e.info.mask,this.currentImg.info.info=e.info.info,this.currentImg.info.number=e.info.number,this.currentImg.info.color=e.info.color),this.viewerImg.snsId=e.snsId,this.viewerImg.type=e.type,this.viewerImg.src=e.src,this.viewerImg.date=e.date,this.viewerImg.info.age=e.info.age,this.viewerImg.info.gender=e.info.gender,this.viewerImg.info.mask=e.info.mask,this.viewerImg.info.info=e.info.info,this.viewerImg.info.number=e.info.number,this.viewerImg.info.color=e.info.color,this.showViewer=!0}}},E=F,x=s(1001),P=(0,x.Z)(E,i,n,!1,null,"b2d1e03c",null),z=P.exports},3162:function(e,t,s){var i,n,a;(function(s,o){n=[],i=o,a="function"===typeof i?i.apply(t,n):i,void 0===a||(e.exports=a)})(0,(function(){"use strict";function t(e,t){return"undefined"==typeof t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}function i(e,t,s){var i=new XMLHttpRequest;i.open("GET",e),i.responseType="blob",i.onload=function(){c(i.response,t,s)},i.onerror=function(){console.error("could not download file")},i.send()}function n(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function a(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(i){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var o="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof s.g&&s.g.global===s.g?s.g:void 0,r=o.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),c=o.saveAs||("object"!=typeof window||window!==o?function(){}:"download"in HTMLAnchorElement.prototype&&!r?function(e,t,s){var r=o.URL||o.webkitURL,c=document.createElement("a");t=t||e.name||"download",c.download=t,c.rel="noopener","string"==typeof e?(c.href=e,c.origin===location.origin?a(c):n(c.href)?i(e,t,s):a(c,c.target="_blank")):(c.href=r.createObjectURL(e),setTimeout((function(){r.revokeObjectURL(c.href)}),4e4),setTimeout((function(){a(c)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,s,o){if(s=s||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(t(e,o),s);else if(n(e))i(e,s,o);else{var r=document.createElement("a");r.href=e,r.target="_blank",setTimeout((function(){a(r)}))}}:function(e,t,s,n){if(n=n||open("","_blank"),n&&(n.document.title=n.document.body.innerText="downloading..."),"string"==typeof e)return i(e,t,s);var a="application/octet-stream"===e.type,c=/constructor/i.test(o.HTMLElement)||o.safari,l=/CriOS\/[\d]+/.test(navigator.userAgent);if((l||a&&c||r)&&"undefined"!=typeof FileReader){var m=new FileReader;m.onloadend=function(){var e=m.result;e=l?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=e:location=e,n=null},m.readAsDataURL(e)}else{var p=o.URL||o.webkitURL,d=p.createObjectURL(e);n?n.location=d:location.href=d,n=null,setTimeout((function(){p.revokeObjectURL(d)}),4e4)}});o.saveAs=c.saveAs=c,e.exports=c}))},577:function(e){
/*!
* screenfull
* v5.2.0 - 2021-11-03
* (c) Sindre Sorhus; MIT License
*/
(function(){"use strict";var t="undefined"!==typeof window&&"undefined"!==typeof window.document?window.document:{},s=e.exports,i=function(){for(var e,s=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],i=0,n=s.length,a={};i<n;i++)if(e=s[i],e&&e[1]in t){for(i=0;i<e.length;i++)a[s[0][i]]=e[i];return a}return!1}(),n={change:i.fullscreenchange,error:i.fullscreenerror},a={request:function(e,s){return new Promise(function(n,a){var o=function(){this.off("change",o),n()}.bind(this);this.on("change",o),e=e||t.documentElement;var r=e[i.requestFullscreen](s);r instanceof Promise&&r.then(o).catch(a)}.bind(this))},exit:function(){return new Promise(function(e,s){if(this.isFullscreen){var n=function(){this.off("change",n),e()}.bind(this);this.on("change",n);var a=t[i.exitFullscreen]();a instanceof Promise&&a.then(n).catch(s)}else e()}.bind(this))},toggle:function(e,t){return this.isFullscreen?this.exit():this.request(e,t)},onchange:function(e){this.on("change",e)},onerror:function(e){this.on("error",e)},on:function(e,s){var i=n[e];i&&t.addEventListener(i,s,!1)},off:function(e,s){var i=n[e];i&&t.removeEventListener(i,s,!1)},raw:i};i?(Object.defineProperties(a,{isFullscreen:{get:function(){return Boolean(t[i.fullscreenElement])}},element:{enumerable:!0,get:function(){return t[i.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return Boolean(t[i.fullscreenEnabled])}}}),s?e.exports=a:window.screenfull=a):s?e.exports={isEnabled:!1}:window.screenfull={isEnabled:!1}})()}}]);